server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /tmp/positions.yaml

clients:
  - url: http://localhost:3100/loki/api/v1/push

scrape_configs:
- job_name: system
  static_configs:
  - targets:
      - localhost
    labels:
      job: varlogs
      __path__: /var/log/*log
- job_name: apache
  pipeline_stages:
  - match:
      selector: '{job="apache"}'
      stages:
      - regex:
          expression: "^(?P<ip>\\S+) (?P<identd>\\S+) (?P<user>\\S+) \\[(?P<timestamp>[\\w:/]+\\s[+\\-]\\d{4})\\] \"(?P<action>\\S+)\\s?(?P<path>\\S+)?\\s?(?P<protocol>\\S+)?\" (?P<status_code>\\d{3}|-) (?P<size>\\d+|-)\\s?\"?(?P<referer>[^\"]*)\"?\\s?\"?(?P<useragent>[^\"]*)?\"?$"
      - labels:
          ip:
          #identd:
          #user:
          #timestamp:
          #action:
          #path:
          #protocol:
          #status_code:
          #size:
          referer:
          #useragent:
  static_configs:
  - targets:
     - localhost
    labels:
      job: apache
      #env: dev
      __path__: /var/log/apache2/access.log
